# .github/workflows/ci.yml
#
# CI (Continuous Integration) ì›Œí¬í”Œë¡œìš°
#
# PRì´ ìƒì„±ë˜ê±°ë‚˜ main/develop ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ
# ìë™ìœ¼ë¡œ ë¹Œë“œì™€ ë¦°íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

name: CI/CD Pipeline

# ============================================
# íŠ¸ë¦¬ê±° ì¡°ê±´: ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ë‚˜ìš”?
# ============================================
on:
  # main, develop ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ
  push:
    branches:
      - main
      - develop

  # PRì´ ìƒì„±ë˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ë  ë•Œ
  pull_request:
    branches:
      - main
      - develop

# ============================================
# ì‘ì—… ì •ì˜: ë¬´ì—‡ì„ ì‹¤í–‰í•˜ë‚˜ìš”?
# ============================================
jobs:
  # ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ ì‘ì—…
  build:
    # ì‹¤í–‰ í™˜ê²½: Ubuntu ìµœì‹  ë²„ì „
    runs-on: ubuntu-latest

    # ì‘ì—… ë‹¨ê³„ë“¤
    steps:
      # Step 1: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      # ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
      - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      # Step 2: Node.js ì„¤ì •
      # Node.js í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤
      - name: ğŸ“¦ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      # Step 3: ì˜ì¡´ì„± ì„¤ì¹˜
      # package.jsonì˜ íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤
      - name: ğŸ“š ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci

      # Step 4: ë¦°íŠ¸ ê²€ì‚¬
      # ì½”ë“œ ìŠ¤íƒ€ì¼ì„ ê²€ì‚¬í•©ë‹ˆë‹¤
      - name: ğŸ” ë¦°íŠ¸ ê²€ì‚¬
        run: npm run lint

      # Step 5: TypeScript íƒ€ì… ì²´í¬
      # íƒ€ì… ì˜¤ë¥˜ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤
      - name: ğŸ” íƒ€ì… ì²´í¬
        run: npx tsc --noEmit

      # Step 6: ë¹Œë“œ
      # í”„ë¡œë•ì…˜ ë¹Œë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤
      - name: ğŸ—ï¸ ë¹Œë“œ
        run: npm run build

      # Step 7: ë¹Œë“œ ê²°ê³¼ë¬¼ ì—…ë¡œë“œ (ì„ íƒì‚¬í•­)
      # ë¹Œë“œëœ íŒŒì¼ì„ ì•„í‹°íŒ©íŠ¸ë¡œ ì €ì¥í•©ë‹ˆë‹¤
      - name: ğŸ“¤ ë¹Œë“œ ê²°ê³¼ë¬¼ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist
          retention-days: 7
